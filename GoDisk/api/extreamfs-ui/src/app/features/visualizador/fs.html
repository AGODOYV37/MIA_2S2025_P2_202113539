<h2 class="title">Visualizador del Sistema de Archivos</h2>

<div *ngIf="loading" class="state">Actualizando…</div>
<div *ngIf="!loading && error" class="state error">{{ error }}</div>

<div *ngIf="!loading && !error">
  <!-- Breadcrumb -->
  <div class="crumbs">
    <ng-container *ngFor="let c of crumbs(); let last = last">
      <a *ngIf="!last"
         [routerLink]="['/visualizador', id, 'fs']"
         [queryParams]="{ ruta: c.abs }">
        {{ c.label }}
      </a>
      <span *ngIf="last">{{ c.label }}</span>
      <span *ngIf="!last" class="sep">/</span>
    </ng-container>
  </div>

  <div class="hint">Navegue entre carpetas; los archivos se habilitarán más adelante</div>

  <header class="fs-head">
    <button class="back"
            type="button"
            [routerLink]="['/visualizador', id, 'fs']"
            [queryParams]="{ ruta: isRoot ? '/' : parent(ruta) }">
      {{ isRoot ? '⟵ Volver' : '⟵ Arriba' }}
    </button>
    <div class="crumb">Ruta: <code>{{ ruta }}</code></div>
  </header>

  <div class="grid">
    <!-- Carpetas -->
    <a class="item dir"
       *ngFor="let d of dirs"
       [routerLink]="['/visualizador', id, 'fs']"
       [queryParams]="{ ruta: d.abs }">
       <img class="ico" src="icons/folder.png" alt="Carpeta" loading="lazy" decoding="async">
      <div class="name" [title]="d.name">{{ d.name }}</div>
      <div class="meta">Carpeta</div>
    </a>

    <!-- Archivos: ahora clic abre visor -->
    <button class="item file" *ngFor="let f of files" type="button" (click)="openFile(f)">
      <img class="ico" src="icons/document.png" alt="Archivo" loading="lazy" decoding="async">
      <div class="name" [title]="f.name">{{ f.name }}</div>
      <div class="meta">Archivo</div>
    </button>
  </div>

  <!-- Visor de archivo debajo del grid -->
  <div class="preview" *ngIf="filePath">
    <div class="pv-head">
      <div class="pv-info">
        <b>Archivo:</b> <code>{{ filePath }}</code>
      </div>
      <div class="pv-actions">
        <span *ngIf="fileLoading" class="pv-loading">Cargando…</span>
        <button *ngIf="!fileLoading" type="button" class="pv-close" (click)="closeFile()">✕ Cerrar</button>
      </div>
    </div>

    <div *ngIf="fileError" class="pv-error">{{ fileError }}</div>
    <pre *ngIf="!fileError && fileText !== null" class="pv-body">{{ fileText }}</pre>
  </div>
</div>
