<h2 class="title">Particiones de {{ baseName(diskPath) }}</h2>

<div *ngIf="loading" class="state">Actualizando…</div>
<div *ngIf="!loading && error" class="state error">{{ error }}</div>

<div *ngIf="!loading && !error">
  <div class="meta">
    <span><b>Disco:</b> {{ diskPath || '—' }}</span>
    <span><b>ID base:</b> {{ id }}</span>
  </div>

  <div *ngIf="parts.length === 0" class="state">
    No se detectaron particiones en este disco.
  </div>

  <!-- Sesión actual -->
  <ng-container *ngIf="(auth.session$ | async) as s">
    <div *ngIf="parts.length" class="grid">
      <ng-container *ngFor="let p of parts">

        <!-- Acceso permitido SOLO a la partición de la sesión -->
        <a *ngIf="p.mountId && p.mountId === s.mountId; else disabledCard"
           class="part"
           [class.pm]="p.kind === 'P'"
           [class.lg]="p.kind === 'L'"
           [routerLink]="['/visualizador', p.mountId, 'fs']"
           [queryParams]="{ ruta: '/' }">
        <img class="icon"
            [src]="p.kind === 'P' ? 'icons/hard-drive.png' : 'icons/partition_logical.png'"
            [alt]="p.kind === 'P' ? 'Partición primaria' : 'Partición lógica'"
            loading="lazy" decoding="async">
          <div class="name" [title]="p.name">{{ p.name }}</div>
          <div class="sub">
            {{ p.kind === 'P' ? 'Primaria' : 'Lógica' }} •
            {{ p.size | number }} bytes ({{ p.percent | number:'1.0-2' }}%)
          </div>
          <div class="status">Montada: <code>{{ p.mountId }}</code></div>
        </a>

        <!-- Deshabilitada si no está montada o pertenece a otra sesión -->
        <ng-template #disabledCard>
          <div class="part disabled"
               [class.pm]="p.kind === 'P'"
               [class.lg]="p.kind === 'L'">
          <img class="icon"
              [src]="p.kind === 'P' ? 'icons/hard-drive.png' : 'icons/partition_logical.png'"
              [alt]="p.kind === 'P' ? 'Partición primaria' : 'Partición lógica'"
              loading="lazy" decoding="async">

            <div class="name" [title]="p.name">{{ p.name }}</div>
            <div class="sub">
              {{ p.kind === 'P' ? 'Primaria' : 'Lógica' }} •
              {{ p.size | number }} bytes ({{ p.percent | number:'1.0-2' }}%)
            </div>
            <div class="status off">
              {{ p.mountId ? 'Restringida' : 'No montada' }}
            </div>
          </div>
        </ng-template>

      </ng-container>
    </div>
  </ng-container>

  <p style="margin-top:14px;">
    <a routerLink="/visualizador">⟵ Volver</a>
  </p>
</div>
